(* ::Package:: *)

(* ::Input::Initialization:: *)
(*Here we use contractions of embedded vectors as variables. PP[i,j]\[Equal]-2Subscript[P, i]\[CenterDot]Subscript[P, j], ZP[{i,l},j]\[Equal]\!\(
\*SubsuperscriptBox[\(Z\), \(i\), \(l\)]\[CenterDot]
\*SubscriptBox[\(P\), \(j\)]\), Z2[{i,l},{j,k}]\[Equal]\!\(
\*SubsuperscriptBox[\(Z\), \(i\), \(l\)]\[CenterDot]
\*SubsuperscriptBox[\(Z\), \(i\), \(k\)]\) *)
Attributes[PP]={Orderless};
Attributes[Z2]={Orderless};
(*the dimension of the embedding space is dim==d+2 where d is the physical space dimension*)


(*Building block definitions*)
VV[i_,j_,k_,Z[pol_]]:=-(1/Sqrt[PP[i,j]]) 1/Sqrt[PP[i,k]] 1/Sqrt[PP[j,k]] PP[i,j]ZP[{i,pol},k]+1/Sqrt[PP[i,j]] 1/Sqrt[PP[i,k]] 1/Sqrt[PP[j,k]] PP[i,k]ZP[{i,pol},j];
HH[i_,j_,Z[poli_],Z[polj_]]:=Z2[{i,poli},{j,polj}]+2/PP[i,j] ZP[{i,poli},j]ZP[{j,polj},i];


(* ::Input::Initialization:: *)
(*two point function*)
twopf[i_,j_][\[CapitalDelta]_,{l1_,l2_,l3_}]:=HH[i,j,Z[1],Z[1]]^(l1-l2) (HH[i,j,Z[1],Z[2]] HH[i,j,Z[2],Z[1]]-HH[i,j,Z[1],Z[1]] HH[i,j,Z[2],Z[2]])^(l2-l3) (HH[i,j,Z[1],Z[3]] (HH[i,j,Z[2],Z[2]] HH[i,j,Z[3],Z[1]]-HH[i,j,Z[2],Z[1]] HH[i,j,Z[3],Z[2]])+HH[i,j,Z[1],Z[2]] (-HH[i,j,Z[2],Z[3]] HH[i,j,Z[3],Z[1]]+HH[i,j,Z[2],Z[1]] HH[i,j,Z[3],Z[3]])+HH[i,j,Z[1],Z[1]] (HH[i,j,Z[2],Z[3]] HH[i,j,Z[3],Z[2]]-HH[i,j,Z[2],Z[2]] HH[i,j,Z[3],Z[3]]))^l3 PP[i,j]^-\[CapitalDelta];

(*threepf[i,j,k][\[CapitalDelta]1,{l11,l12,l13}][\[CapitalDelta]2,{l21,l22,l23}][\[CapitalDelta]3,{l31,l32,l33}]
i,j,k are the coordinates of the fields in reps {\[CapitalDelta]1,{l11,l12,l13}},{\[CapitalDelta]2,{l21,l22,l23}},{\[CapitalDelta]3,{l31,l32,l33}} in that order.The different tensor structures are multiplied by constants cons[m].*)

(*extract in-th tensor structure*)
threepfC[a__][b__][c__][d__][in_]:=If[in===trivial,threepf[a][b][c][d],(threepf[a][b][c][d]/.cons[in]->1/.cons[_]->0)];

threepf[i_,j_,k_][\[CapitalDelta]1_,{l2_,l3_,0}][\[CapitalDelta]2_,{0,0,0}][\[CapitalDelta]_,{l1_,l2_,l3_}]:=PP[k,i]^(1/2 (-\[CapitalDelta]-\[CapitalDelta]1+\[CapitalDelta]2)) PP[k,j]^(1/2 (-\[CapitalDelta]+\[CapitalDelta]1-\[CapitalDelta]2)) PP[i,j]^(1/2 (\[CapitalDelta]-\[CapitalDelta]1-\[CapitalDelta]2)) VV[k,i,j,Z[1]]^(l1-l2) (HH[k,i,Z[2],Z[1]] VV[k,i,j,Z[1]]-HH[k,i,Z[1],Z[1]] VV[k,i,j,Z[2]])^(l2-l3) (-HH[k,i,Z[2],Z[2]] HH[k,i,Z[3],Z[1]] VV[k,i,j,Z[1]]+HH[k,i,Z[2],Z[1]] HH[k,i,Z[3],Z[2]] VV[k,i,j,Z[1]]+HH[k,i,Z[1],Z[2]] HH[k,i,Z[3],Z[1]] VV[k,i,j,Z[2]]-HH[k,i,Z[1],Z[1]] HH[k,i,Z[3],Z[2]] VV[k,i,j,Z[2]]-HH[k,i,Z[1],Z[2]] HH[k,i,Z[2],Z[1]] VV[k,i,j,Z[3]]+HH[k,i,Z[1],Z[1]] HH[k,i,Z[2],Z[2]] VV[k,i,j,Z[3]])^l3;
threepf[i_,j_,k_][\[CapitalDelta]1_,{l2p_,l3_,0}][\[CapitalDelta]2_,{0,0,0}][\[CapitalDelta]_,{l1_,l2_,l3_}]/;l2p==l2+1:=PP[i,j]^(\[CapitalDelta]/2-\[CapitalDelta]1/2-\[CapitalDelta]2/2) PP[i,k]^(-(\[CapitalDelta]/2)-\[CapitalDelta]1/2+\[CapitalDelta]2/2) PP[j,k]^(-(\[CapitalDelta]/2)+\[CapitalDelta]1/2-\[CapitalDelta]2/2) VV[k,i,j,Z[1]]^(-1+l1-l2) (cons[2] HH[k,i,Z[1],Z[1]]+cons[1] VV[i,k,j,Z[1]] VV[k,i,j,Z[1]])(HH[k,i,Z[2],Z[1]] VV[k,i,j,Z[1]]-HH[k,i,Z[1],Z[1]] VV[k,i,j,Z[2]])^(l2-l3) (-HH[k,i,Z[2],Z[2]] HH[k,i,Z[3],Z[1]] VV[k,i,j,Z[1]]+HH[k,i,Z[2],Z[1]] HH[k,i,Z[3],Z[2]] VV[k,i,j,Z[1]]+HH[k,i,Z[1],Z[2]] HH[k,i,Z[3],Z[1]] VV[k,i,j,Z[2]]-HH[k,i,Z[1],Z[1]] HH[k,i,Z[3],Z[2]] VV[k,i,j,Z[2]]-HH[k,i,Z[1],Z[2]] HH[k,i,Z[2],Z[1]] VV[k,i,j,Z[3]]+HH[k,i,Z[1],Z[1]] HH[k,i,Z[2],Z[2]] VV[k,i,j,Z[3]])^l3;
threepf[i_,j_,k_][\[CapitalDelta]1_,{l2_,l3p_,0}][\[CapitalDelta]2_,{0,0,0}][\[CapitalDelta]_,{l1_,l2_,l3_}]/;(l3p==l3+1):=PP[i,j]^(\[CapitalDelta]/2-\[CapitalDelta]1/2-\[CapitalDelta]2/2) PP[i,k]^(-(\[CapitalDelta]/2)-\[CapitalDelta]1/2+\[CapitalDelta]2/2) PP[j,k]^(-(\[CapitalDelta]/2)+\[CapitalDelta]1/2-\[CapitalDelta]2/2) VV[k,i,j,Z[1]]^(l1-l2) (cons[2] (-HH[k,i,Z[1],Z[2]] HH[k,i,Z[2],Z[1]]+HH[k,i,Z[1],Z[1]] HH[k,i,Z[2],Z[2]])+cons[1] (HH[k,i,Z[2],Z[2]] VV[i,k,j,Z[1]] VV[k,i,j,Z[1]]-HH[k,i,Z[2],Z[1]] VV[i,k,j,Z[2]] VV[k,i,j,Z[1]]-HH[k,i,Z[1],Z[2]] VV[i,k,j,Z[1]] VV[k,i,j,Z[2]]+HH[k,i,Z[1],Z[1]] VV[i,k,j,Z[2]] VV[k,i,j,Z[2]]))(HH[k,i,Z[2],Z[1]] VV[k,i,j,Z[1]]-HH[k,i,Z[1],Z[1]] VV[k,i,j,Z[2]])^(-1+l2-l3)  (-HH[k,i,Z[2],Z[2]] HH[k,i,Z[3],Z[1]] VV[k,i,j,Z[1]]+HH[k,i,Z[2],Z[1]] HH[k,i,Z[3],Z[2]] VV[k,i,j,Z[1]]+HH[k,i,Z[1],Z[2]] HH[k,i,Z[3],Z[1]] VV[k,i,j,Z[2]]-HH[k,i,Z[1],Z[1]] HH[k,i,Z[3],Z[2]] VV[k,i,j,Z[2]]-HH[k,i,Z[1],Z[2]] HH[k,i,Z[2],Z[1]] VV[k,i,j,Z[3]]+HH[k,i,Z[1],Z[1]] HH[k,i,Z[2],Z[2]] VV[k,i,j,Z[3]])^l3;
threepf[i_,j_,k_][\[CapitalDelta]1_,{l2p_,l3p_,0}][\[CapitalDelta]2_,{0,0,0}][\[CapitalDelta]_,{l1_,l2_,l3_}]/;(l3p==l3+1&&l2p==l2+1):=PP[i,j]^(\[CapitalDelta]/2-\[CapitalDelta]1/2-\[CapitalDelta]2/2) PP[i,k]^(-(\[CapitalDelta]/2)-\[CapitalDelta]1/2+\[CapitalDelta]2/2) PP[j,k]^(-(\[CapitalDelta]/2)+\[CapitalDelta]1/2-\[CapitalDelta]2/2) VV[k,i,j,Z[1]]^(l1-l2-1) (cons[4] (-HH[k,i,Z[1],Z[2]] HH[k,i,Z[2],Z[1]]+HH[k,i,Z[1],Z[1]] HH[k,i,Z[2],Z[2]])HH[k,i,Z[1],Z[1]]+cons[3] VV[i,k,j,Z[1]] VV[k,i,j,Z[1]](-HH[k,i,Z[1],Z[2]] HH[k,i,Z[2],Z[1]]+HH[k,i,Z[1],Z[1]] HH[k,i,Z[2],Z[2]])+cons[2] HH[k,i,Z[1],Z[1]](HH[k,i,Z[2],Z[2]] VV[i,k,j,Z[1]] VV[k,i,j,Z[1]]-HH[k,i,Z[2],Z[1]] VV[i,k,j,Z[2]] VV[k,i,j,Z[1]]-HH[k,i,Z[1],Z[2]] VV[i,k,j,Z[1]] VV[k,i,j,Z[2]]+HH[k,i,Z[1],Z[1]] VV[i,k,j,Z[2]] VV[k,i,j,Z[2]])+cons[1] VV[i,k,j,Z[1]] VV[k,i,j,Z[1]](HH[k,i,Z[2],Z[2]] VV[i,k,j,Z[1]] VV[k,i,j,Z[1]]-HH[k,i,Z[2],Z[1]] VV[i,k,j,Z[2]] VV[k,i,j,Z[1]]-HH[k,i,Z[1],Z[2]] VV[i,k,j,Z[1]] VV[k,i,j,Z[2]]+HH[k,i,Z[1],Z[1]] VV[i,k,j,Z[2]] VV[k,i,j,Z[2]]))(HH[k,i,Z[2],Z[1]] VV[k,i,j,Z[1]]-HH[k,i,Z[1],Z[1]] VV[k,i,j,Z[2]])^(-1+l2-l3)  (-HH[k,i,Z[2],Z[2]] HH[k,i,Z[3],Z[1]] VV[k,i,j,Z[1]]+HH[k,i,Z[2],Z[1]] HH[k,i,Z[3],Z[2]] VV[k,i,j,Z[1]]+HH[k,i,Z[1],Z[2]] HH[k,i,Z[3],Z[1]] VV[k,i,j,Z[2]]-HH[k,i,Z[1],Z[1]] HH[k,i,Z[3],Z[2]] VV[k,i,j,Z[2]]-HH[k,i,Z[1],Z[2]] HH[k,i,Z[2],Z[1]] VV[k,i,j,Z[3]]+HH[k,i,Z[1],Z[1]] HH[k,i,Z[2],Z[2]] VV[k,i,j,Z[3]])^l3;
threepf[i_,j_,k_][\[CapitalDelta]1_,{l2p_,l3_,0}][\[CapitalDelta]2_,{0,0,0}][\[CapitalDelta]_,{l1_,l2_,l3_}]/;l2p==l2+2:=PP[i,j]^(\[CapitalDelta]/2-\[CapitalDelta]1/2-\[CapitalDelta]2/2) PP[i,k]^(-(\[CapitalDelta]/2)-\[CapitalDelta]1/2+\[CapitalDelta]2/2) PP[j,k]^(-(\[CapitalDelta]/2)+\[CapitalDelta]1/2-\[CapitalDelta]2/2) VV[k,i,j,Z[1]]^(-2+l1-l2) (cons[3] HH[k,i,Z[1],Z[1]]^2+cons[2] HH[k,i,Z[1],Z[1]]VV[i,k,j,Z[1]] VV[k,i,j,Z[1]]+cons[1] VV[i,k,j,Z[1]]^2 VV[k,i,j,Z[1]]^2)(HH[k,i,Z[2],Z[1]] VV[k,i,j,Z[1]]-HH[k,i,Z[1],Z[1]] VV[k,i,j,Z[2]])^(l2-l3) (-HH[k,i,Z[2],Z[2]] HH[k,i,Z[3],Z[1]] VV[k,i,j,Z[1]]+HH[k,i,Z[2],Z[1]] HH[k,i,Z[3],Z[2]] VV[k,i,j,Z[1]]+HH[k,i,Z[1],Z[2]] HH[k,i,Z[3],Z[1]] VV[k,i,j,Z[2]]-HH[k,i,Z[1],Z[1]] HH[k,i,Z[3],Z[2]] VV[k,i,j,Z[2]]-HH[k,i,Z[1],Z[2]] HH[k,i,Z[2],Z[1]] VV[k,i,j,Z[3]]+HH[k,i,Z[1],Z[1]] HH[k,i,Z[2],Z[2]] VV[k,i,j,Z[3]])^l3;
threepf[i_,j_,k_][\[CapitalDelta]1_,{l2_,l3p_,0}][\[CapitalDelta]2_,{0,0,0}][\[CapitalDelta]_,{l1_,l2_,l3_}]/;(l3p==l3+2):=PP[i,j]^(\[CapitalDelta]/2-\[CapitalDelta]1/2-\[CapitalDelta]2/2) PP[i,k]^(-(\[CapitalDelta]/2)-\[CapitalDelta]1/2+\[CapitalDelta]2/2) PP[j,k]^(-(\[CapitalDelta]/2)+\[CapitalDelta]1/2-\[CapitalDelta]2/2) VV[k,i,j,Z[1]]^(l1-l2) (cons[1](HH[k,i,Z[2],Z[2]] VV[i,k,j,Z[1]] VV[k,i,j,Z[1]]-HH[k,i,Z[2],Z[1]] VV[i,k,j,Z[2]] VV[k,i,j,Z[1]]-HH[k,i,Z[1],Z[2]] VV[i,k,j,Z[1]] VV[k,i,j,Z[2]]+HH[k,i,Z[1],Z[1]] VV[i,k,j,Z[2]] VV[k,i,j,Z[2]])^2+cons[2](-HH[k,i,Z[1],Z[2]] HH[k,i,Z[2],Z[1]]+HH[k,i,Z[1],Z[1]] HH[k,i,Z[2],Z[2]])(HH[k,i,Z[2],Z[2]] VV[i,k,j,Z[1]] VV[k,i,j,Z[1]]-HH[k,i,Z[2],Z[1]] VV[i,k,j,Z[2]] VV[k,i,j,Z[1]]-HH[k,i,Z[1],Z[2]] VV[i,k,j,Z[1]] VV[k,i,j,Z[2]]+HH[k,i,Z[1],Z[1]] VV[i,k,j,Z[2]] VV[k,i,j,Z[2]])+cons[3](-HH[k,i,Z[1],Z[2]] HH[k,i,Z[2],Z[1]]+HH[k,i,Z[1],Z[1]] HH[k,i,Z[2],Z[2]])^2)(HH[k,i,Z[2],Z[1]] VV[k,i,j,Z[1]]-HH[k,i,Z[1],Z[1]] VV[k,i,j,Z[2]])^(-2+l2-l3)  (-HH[k,i,Z[2],Z[2]] HH[k,i,Z[3],Z[1]] VV[k,i,j,Z[1]]+HH[k,i,Z[2],Z[1]] HH[k,i,Z[3],Z[2]] VV[k,i,j,Z[1]]+HH[k,i,Z[1],Z[2]] HH[k,i,Z[3],Z[1]] VV[k,i,j,Z[2]]-HH[k,i,Z[1],Z[1]] HH[k,i,Z[3],Z[2]] VV[k,i,j,Z[2]]-HH[k,i,Z[1],Z[2]] HH[k,i,Z[2],Z[1]] VV[k,i,j,Z[3]]+HH[k,i,Z[1],Z[1]] HH[k,i,Z[2],Z[2]] VV[k,i,j,Z[3]])^l3;
threepf[i_,j_,k_][\[CapitalDelta]1_,{l2p_,l3p_,0}][\[CapitalDelta]2_,{0,0,0}][\[CapitalDelta]_,{l1_,l2_,l3_}]/;(l2p==l2-1&&l3p==l3+1):=0;
threepf[i_,j_,k_][\[CapitalDelta]1_,{l2p_,l3p_,0}][\[CapitalDelta]2_,{0,0,0}][\[CapitalDelta]_,{l1_,l2_,l3_}]/;(l2p==l2+1&&l3p==l3-1):=0;
threepf[i_,j_,k_][\[CapitalDelta]1_,{l2p_,l3_,1}][\[CapitalDelta]2_,{0,0,0}][\[CapitalDelta]_,{l1_,l2_,l3_}]/;(l2p==l2+1):=PP[i,j]^(\[CapitalDelta]/2-\[CapitalDelta]1/2-\[CapitalDelta]2/2) PP[i,k]^(-(\[CapitalDelta]/2)-\[CapitalDelta]1/2+\[CapitalDelta]2/2) PP[j,k]^(-(\[CapitalDelta]/2)+\[CapitalDelta]1/2-\[CapitalDelta]2/2) VV[k,i,j,Z[1]]^(l1-l2-1) (cons[1] VV[k,i,j,Z[1]]VV[i,k,j,Z[1]](-2 HH[k,i,Z[2],Z[3]] HH[k,i,Z[3],Z[2]] VV[i,k,j,Z[1]] VV[k,i,j,Z[1]]+2 HH[k,i,Z[2],Z[2]] HH[k,i,Z[3],Z[3]] VV[i,k,j,Z[1]] VV[k,i,j,Z[1]]+2 HH[k,i,Z[2],Z[3]] HH[k,i,Z[3],Z[1]] VV[i,k,j,Z[2]] VV[k,i,j,Z[1]]-2 HH[k,i,Z[2],Z[1]] HH[k,i,Z[3],Z[3]] VV[i,k,j,Z[2]] VV[k,i,j,Z[1]]-2 HH[k,i,Z[2],Z[2]] HH[k,i,Z[3],Z[1]] VV[i,k,j,Z[3]] VV[k,i,j,Z[1]]+2 HH[k,i,Z[2],Z[1]] HH[k,i,Z[3],Z[2]] VV[i,k,j,Z[3]] VV[k,i,j,Z[1]]+2 HH[k,i,Z[1],Z[3]] HH[k,i,Z[3],Z[2]] VV[i,k,j,Z[1]] VV[k,i,j,Z[2]]-2 HH[k,i,Z[1],Z[2]] HH[k,i,Z[3],Z[3]] VV[i,k,j,Z[1]] VV[k,i,j,Z[2]]-2 HH[k,i,Z[1],Z[3]] HH[k,i,Z[3],Z[1]] VV[i,k,j,Z[2]] VV[k,i,j,Z[2]]+2 HH[k,i,Z[1],Z[1]] HH[k,i,Z[3],Z[3]] VV[i,k,j,Z[2]] VV[k,i,j,Z[2]]+2 HH[k,i,Z[1],Z[2]] HH[k,i,Z[3],Z[1]] VV[i,k,j,Z[3]] VV[k,i,j,Z[2]]-2 HH[k,i,Z[1],Z[1]] HH[k,i,Z[3],Z[2]] VV[i,k,j,Z[3]] VV[k,i,j,Z[2]]-2 HH[k,i,Z[1],Z[3]] HH[k,i,Z[2],Z[2]] VV[i,k,j,Z[1]] VV[k,i,j,Z[3]]+2 HH[k,i,Z[1],Z[2]] HH[k,i,Z[2],Z[3]] VV[i,k,j,Z[1]] VV[k,i,j,Z[3]]+2 HH[k,i,Z[1],Z[3]] HH[k,i,Z[2],Z[1]] VV[i,k,j,Z[2]] VV[k,i,j,Z[3]]-2 HH[k,i,Z[1],Z[1]] HH[k,i,Z[2],Z[3]] VV[i,k,j,Z[2]] VV[k,i,j,Z[3]]-2 HH[k,i,Z[1],Z[2]] HH[k,i,Z[2],Z[1]] VV[i,k,j,Z[3]] VV[k,i,j,Z[3]]+2 HH[k,i,Z[1],Z[1]] HH[k,i,Z[2],Z[2]] VV[i,k,j,Z[3]] VV[k,i,j,Z[3]])  +cons[3] VV[k,i,j,Z[1]]VV[i,k,j,Z[1]](-HH[k,i,Z[1],Z[3]] HH[k,i,Z[2],Z[2]] HH[k,i,Z[3],Z[1]]+HH[k,i,Z[1],Z[2]] HH[k,i,Z[2],Z[3]] HH[k,i,Z[3],Z[1]]+HH[k,i,Z[1],Z[3]] HH[k,i,Z[2],Z[1]] HH[k,i,Z[3],Z[2]]-HH[k,i,Z[1],Z[1]] HH[k,i,Z[2],Z[3]] HH[k,i,Z[3],Z[2]]-HH[k,i,Z[1],Z[2]] HH[k,i,Z[2],Z[1]] HH[k,i,Z[3],Z[3]]+HH[k,i,Z[1],Z[1]] HH[k,i,Z[2],Z[2]] HH[k,i,Z[3],Z[3]])  +cons[2]HH[k,i,Z[1],Z[1]](-2 HH[k,i,Z[2],Z[3]] HH[k,i,Z[3],Z[2]] VV[i,k,j,Z[1]] VV[k,i,j,Z[1]]+2 HH[k,i,Z[2],Z[2]] HH[k,i,Z[3],Z[3]] VV[i,k,j,Z[1]] VV[k,i,j,Z[1]]+2 HH[k,i,Z[2],Z[3]] HH[k,i,Z[3],Z[1]] VV[i,k,j,Z[2]] VV[k,i,j,Z[1]]-2 HH[k,i,Z[2],Z[1]] HH[k,i,Z[3],Z[3]] VV[i,k,j,Z[2]] VV[k,i,j,Z[1]]-2 HH[k,i,Z[2],Z[2]] HH[k,i,Z[3],Z[1]] VV[i,k,j,Z[3]] VV[k,i,j,Z[1]]+2 HH[k,i,Z[2],Z[1]] HH[k,i,Z[3],Z[2]] VV[i,k,j,Z[3]] VV[k,i,j,Z[1]]+2 HH[k,i,Z[1],Z[3]] HH[k,i,Z[3],Z[2]] VV[i,k,j,Z[1]] VV[k,i,j,Z[2]]-2 HH[k,i,Z[1],Z[2]] HH[k,i,Z[3],Z[3]] VV[i,k,j,Z[1]] VV[k,i,j,Z[2]]-2 HH[k,i,Z[1],Z[3]] HH[k,i,Z[3],Z[1]] VV[i,k,j,Z[2]] VV[k,i,j,Z[2]]+2 HH[k,i,Z[1],Z[1]] HH[k,i,Z[3],Z[3]] VV[i,k,j,Z[2]] VV[k,i,j,Z[2]]+2 HH[k,i,Z[1],Z[2]] HH[k,i,Z[3],Z[1]] VV[i,k,j,Z[3]] VV[k,i,j,Z[2]]-2 HH[k,i,Z[1],Z[1]] HH[k,i,Z[3],Z[2]] VV[i,k,j,Z[3]] VV[k,i,j,Z[2]]-2 HH[k,i,Z[1],Z[3]] HH[k,i,Z[2],Z[2]] VV[i,k,j,Z[1]] VV[k,i,j,Z[3]]+2 HH[k,i,Z[1],Z[2]] HH[k,i,Z[2],Z[3]] VV[i,k,j,Z[1]] VV[k,i,j,Z[3]]+2 HH[k,i,Z[1],Z[3]] HH[k,i,Z[2],Z[1]] VV[i,k,j,Z[2]] VV[k,i,j,Z[3]]-2 HH[k,i,Z[1],Z[1]] HH[k,i,Z[2],Z[3]] VV[i,k,j,Z[2]] VV[k,i,j,Z[3]]-2 HH[k,i,Z[1],Z[2]] HH[k,i,Z[2],Z[1]] VV[i,k,j,Z[3]] VV[k,i,j,Z[3]]+2 HH[k,i,Z[1],Z[1]] HH[k,i,Z[2],Z[2]] VV[i,k,j,Z[3]] VV[k,i,j,Z[3]])  +cons[4] HH[k,i,Z[1],Z[1]](-HH[k,i,Z[1],Z[3]] HH[k,i,Z[2],Z[2]] HH[k,i,Z[3],Z[1]]+HH[k,i,Z[1],Z[2]] HH[k,i,Z[2],Z[3]] HH[k,i,Z[3],Z[1]]+HH[k,i,Z[1],Z[3]] HH[k,i,Z[2],Z[1]] HH[k,i,Z[3],Z[2]]-HH[k,i,Z[1],Z[1]] HH[k,i,Z[2],Z[3]] HH[k,i,Z[3],Z[2]]-HH[k,i,Z[1],Z[2]] HH[k,i,Z[2],Z[1]] HH[k,i,Z[3],Z[3]]+HH[k,i,Z[1],Z[1]] HH[k,i,Z[2],Z[2]] HH[k,i,Z[3],Z[3]])  )(HH[k,i,Z[2],Z[1]] VV[k,i,j,Z[1]]-HH[k,i,Z[1],Z[1]] VV[k,i,j,Z[2]])^(l2-l3) (-HH[k,i,Z[2],Z[2]] HH[k,i,Z[3],Z[1]] VV[k,i,j,Z[1]]+HH[k,i,Z[2],Z[1]] HH[k,i,Z[3],Z[2]] VV[k,i,j,Z[1]]+HH[k,i,Z[1],Z[2]] HH[k,i,Z[3],Z[1]] VV[k,i,j,Z[2]]-HH[k,i,Z[1],Z[1]] HH[k,i,Z[3],Z[2]] VV[k,i,j,Z[2]]-HH[k,i,Z[1],Z[2]] HH[k,i,Z[2],Z[1]] VV[k,i,j,Z[3]]+HH[k,i,Z[1],Z[1]] HH[k,i,Z[2],Z[2]] VV[k,i,j,Z[3]])^(-1+l3);
threepf[i_,j_,k_][\[CapitalDelta]1_,{l2_,l3p_,1}][\[CapitalDelta]2_,{0,0,0}][\[CapitalDelta]_,{l1_,l2_,l3_}]/;(l3p==l3+1):=PP[i,j]^(\[CapitalDelta]/2-\[CapitalDelta]1/2-\[CapitalDelta]2/2) PP[i,k]^(-(\[CapitalDelta]/2)-\[CapitalDelta]1/2+\[CapitalDelta]2/2) PP[j,k]^(-(\[CapitalDelta]/2)+\[CapitalDelta]1/2-\[CapitalDelta]2/2) VV[k,i,j,Z[1]]^(l1-l2) (cons[1] (HH[k,i,Z[2],Z[2]] VV[i,k,j,Z[1]] VV[k,i,j,Z[1]]-HH[k,i,Z[2],Z[1]] VV[i,k,j,Z[2]] VV[k,i,j,Z[1]]-HH[k,i,Z[1],Z[2]] VV[i,k,j,Z[1]] VV[k,i,j,Z[2]]+HH[k,i,Z[1],Z[1]] VV[i,k,j,Z[2]] VV[k,i,j,Z[2]])(-2 HH[k,i,Z[2],Z[3]] HH[k,i,Z[3],Z[2]] VV[i,k,j,Z[1]] VV[k,i,j,Z[1]]+2 HH[k,i,Z[2],Z[2]] HH[k,i,Z[3],Z[3]] VV[i,k,j,Z[1]] VV[k,i,j,Z[1]]+2 HH[k,i,Z[2],Z[3]] HH[k,i,Z[3],Z[1]] VV[i,k,j,Z[2]] VV[k,i,j,Z[1]]-2 HH[k,i,Z[2],Z[1]] HH[k,i,Z[3],Z[3]] VV[i,k,j,Z[2]] VV[k,i,j,Z[1]]-2 HH[k,i,Z[2],Z[2]] HH[k,i,Z[3],Z[1]] VV[i,k,j,Z[3]] VV[k,i,j,Z[1]]+2 HH[k,i,Z[2],Z[1]] HH[k,i,Z[3],Z[2]] VV[i,k,j,Z[3]] VV[k,i,j,Z[1]]+2 HH[k,i,Z[1],Z[3]] HH[k,i,Z[3],Z[2]] VV[i,k,j,Z[1]] VV[k,i,j,Z[2]]-2 HH[k,i,Z[1],Z[2]] HH[k,i,Z[3],Z[3]] VV[i,k,j,Z[1]] VV[k,i,j,Z[2]]-2 HH[k,i,Z[1],Z[3]] HH[k,i,Z[3],Z[1]] VV[i,k,j,Z[2]] VV[k,i,j,Z[2]]+2 HH[k,i,Z[1],Z[1]] HH[k,i,Z[3],Z[3]] VV[i,k,j,Z[2]] VV[k,i,j,Z[2]]+2 HH[k,i,Z[1],Z[2]] HH[k,i,Z[3],Z[1]] VV[i,k,j,Z[3]] VV[k,i,j,Z[2]]-2 HH[k,i,Z[1],Z[1]] HH[k,i,Z[3],Z[2]] VV[i,k,j,Z[3]] VV[k,i,j,Z[2]]-2 HH[k,i,Z[1],Z[3]] HH[k,i,Z[2],Z[2]] VV[i,k,j,Z[1]] VV[k,i,j,Z[3]]+2 HH[k,i,Z[1],Z[2]] HH[k,i,Z[2],Z[3]] VV[i,k,j,Z[1]] VV[k,i,j,Z[3]]+2 HH[k,i,Z[1],Z[3]] HH[k,i,Z[2],Z[1]] VV[i,k,j,Z[2]] VV[k,i,j,Z[3]]-2 HH[k,i,Z[1],Z[1]] HH[k,i,Z[2],Z[3]] VV[i,k,j,Z[2]] VV[k,i,j,Z[3]]-2 HH[k,i,Z[1],Z[2]] HH[k,i,Z[2],Z[1]] VV[i,k,j,Z[3]] VV[k,i,j,Z[3]]+2 HH[k,i,Z[1],Z[1]] HH[k,i,Z[2],Z[2]] VV[i,k,j,Z[3]] VV[k,i,j,Z[3]])  +cons[3] (HH[k,i,Z[2],Z[2]] VV[i,k,j,Z[1]] VV[k,i,j,Z[1]]-HH[k,i,Z[2],Z[1]] VV[i,k,j,Z[2]] VV[k,i,j,Z[1]]-HH[k,i,Z[1],Z[2]] VV[i,k,j,Z[1]] VV[k,i,j,Z[2]]+HH[k,i,Z[1],Z[1]] VV[i,k,j,Z[2]] VV[k,i,j,Z[2]])(-HH[k,i,Z[1],Z[3]] HH[k,i,Z[2],Z[2]] HH[k,i,Z[3],Z[1]]+HH[k,i,Z[1],Z[2]] HH[k,i,Z[2],Z[3]] HH[k,i,Z[3],Z[1]]+HH[k,i,Z[1],Z[3]] HH[k,i,Z[2],Z[1]] HH[k,i,Z[3],Z[2]]-HH[k,i,Z[1],Z[1]] HH[k,i,Z[2],Z[3]] HH[k,i,Z[3],Z[2]]-HH[k,i,Z[1],Z[2]] HH[k,i,Z[2],Z[1]] HH[k,i,Z[3],Z[3]]+HH[k,i,Z[1],Z[1]] HH[k,i,Z[2],Z[2]] HH[k,i,Z[3],Z[3]])  +cons[2](-HH[k,i,Z[1],Z[2]] HH[k,i,Z[2],Z[1]]+HH[k,i,Z[1],Z[1]] HH[k,i,Z[2],Z[2]])(-2 HH[k,i,Z[2],Z[3]] HH[k,i,Z[3],Z[2]] VV[i,k,j,Z[1]] VV[k,i,j,Z[1]]+2 HH[k,i,Z[2],Z[2]] HH[k,i,Z[3],Z[3]] VV[i,k,j,Z[1]] VV[k,i,j,Z[1]]+2 HH[k,i,Z[2],Z[3]] HH[k,i,Z[3],Z[1]] VV[i,k,j,Z[2]] VV[k,i,j,Z[1]]-2 HH[k,i,Z[2],Z[1]] HH[k,i,Z[3],Z[3]] VV[i,k,j,Z[2]] VV[k,i,j,Z[1]]-2 HH[k,i,Z[2],Z[2]] HH[k,i,Z[3],Z[1]] VV[i,k,j,Z[3]] VV[k,i,j,Z[1]]+2 HH[k,i,Z[2],Z[1]] HH[k,i,Z[3],Z[2]] VV[i,k,j,Z[3]] VV[k,i,j,Z[1]]+2 HH[k,i,Z[1],Z[3]] HH[k,i,Z[3],Z[2]] VV[i,k,j,Z[1]] VV[k,i,j,Z[2]]-2 HH[k,i,Z[1],Z[2]] HH[k,i,Z[3],Z[3]] VV[i,k,j,Z[1]] VV[k,i,j,Z[2]]-2 HH[k,i,Z[1],Z[3]] HH[k,i,Z[3],Z[1]] VV[i,k,j,Z[2]] VV[k,i,j,Z[2]]+2 HH[k,i,Z[1],Z[1]] HH[k,i,Z[3],Z[3]] VV[i,k,j,Z[2]] VV[k,i,j,Z[2]]+2 HH[k,i,Z[1],Z[2]] HH[k,i,Z[3],Z[1]] VV[i,k,j,Z[3]] VV[k,i,j,Z[2]]-2 HH[k,i,Z[1],Z[1]] HH[k,i,Z[3],Z[2]] VV[i,k,j,Z[3]] VV[k,i,j,Z[2]]-2 HH[k,i,Z[1],Z[3]] HH[k,i,Z[2],Z[2]] VV[i,k,j,Z[1]] VV[k,i,j,Z[3]]+2 HH[k,i,Z[1],Z[2]] HH[k,i,Z[2],Z[3]] VV[i,k,j,Z[1]] VV[k,i,j,Z[3]]+2 HH[k,i,Z[1],Z[3]] HH[k,i,Z[2],Z[1]] VV[i,k,j,Z[2]] VV[k,i,j,Z[3]]-2 HH[k,i,Z[1],Z[1]] HH[k,i,Z[2],Z[3]] VV[i,k,j,Z[2]] VV[k,i,j,Z[3]]-2 HH[k,i,Z[1],Z[2]] HH[k,i,Z[2],Z[1]] VV[i,k,j,Z[3]] VV[k,i,j,Z[3]]+2 HH[k,i,Z[1],Z[1]] HH[k,i,Z[2],Z[2]] VV[i,k,j,Z[3]] VV[k,i,j,Z[3]])  +cons[4] (-HH[k,i,Z[1],Z[2]] HH[k,i,Z[2],Z[1]]+HH[k,i,Z[1],Z[1]] HH[k,i,Z[2],Z[2]])(-HH[k,i,Z[1],Z[3]] HH[k,i,Z[2],Z[2]] HH[k,i,Z[3],Z[1]]+HH[k,i,Z[1],Z[2]] HH[k,i,Z[2],Z[3]] HH[k,i,Z[3],Z[1]]+HH[k,i,Z[1],Z[3]] HH[k,i,Z[2],Z[1]] HH[k,i,Z[3],Z[2]]-HH[k,i,Z[1],Z[1]] HH[k,i,Z[2],Z[3]] HH[k,i,Z[3],Z[2]]-HH[k,i,Z[1],Z[2]] HH[k,i,Z[2],Z[1]] HH[k,i,Z[3],Z[3]]+HH[k,i,Z[1],Z[1]] HH[k,i,Z[2],Z[2]] HH[k,i,Z[3],Z[3]])  )(HH[k,i,Z[2],Z[1]] VV[k,i,j,Z[1]]-HH[k,i,Z[1],Z[1]] VV[k,i,j,Z[2]])^(l2-l3-1) (-HH[k,i,Z[2],Z[2]] HH[k,i,Z[3],Z[1]] VV[k,i,j,Z[1]]+HH[k,i,Z[2],Z[1]] HH[k,i,Z[3],Z[2]] VV[k,i,j,Z[1]]+HH[k,i,Z[1],Z[2]] HH[k,i,Z[3],Z[1]] VV[k,i,j,Z[2]]-HH[k,i,Z[1],Z[1]] HH[k,i,Z[3],Z[2]] VV[k,i,j,Z[2]]-HH[k,i,Z[1],Z[2]] HH[k,i,Z[2],Z[1]] VV[k,i,j,Z[3]]+HH[k,i,Z[1],Z[1]] HH[k,i,Z[2],Z[2]] VV[k,i,j,Z[3]])^(-1+l3);
